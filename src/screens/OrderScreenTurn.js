/* eslint-disable react/prop-types */
// eslint-disable-next-line no-unused-vars
import React, { useEffect, useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { detailsOrder } from '../actions/orderActions';
import LoadingBox from '../components/LoadingBox';
import MessageBox from '../components/MessageBox';
import styles from '../style/OrderScreenTurn.module.css';

import {
	ORDER_DELIVER_RESET,
	ORDER_PAY_RESET,
} from '../constants/orderConstants';

import TurnScreen from './TurnScreen';

export default function OrderScreen(props) {
	const orderId = props.match.params.id;
	const [sdkReady, setSdkReady] = useState(false);
	const orderDetails = useSelector(state => state.orderDetails);
	const { order, loading, error } = orderDetails;

	const orderPay = useSelector(state => state.orderPay);
	const { success: successPay } = orderPay;

	const orderDeliver = useSelector(state => state.orderDeliver);
	const { success: successDeliver } = orderDeliver;

	const dispatch = useDispatch();

	useEffect(() => {
		if (
			!order ||
			successPay ||
			successDeliver ||
			(order && order._id !== orderId)
		) {
			dispatch({ type: ORDER_PAY_RESET });
			dispatch({ type: ORDER_DELIVER_RESET });
			dispatch(detailsOrder(orderId));
		} else {
			if (!order.isPaid) {
				if (!window.paypal) {
					// addPayPalScript();
				} else {
					setSdkReady(true);
				}
			}
		}
	}, [dispatch, orderId, sdkReady, successPay, successDeliver, order]);

	return loading ? (
		<LoadingBox></LoadingBox>
	) : error ? (
		<MessageBox variant='danger'>{error}</MessageBox>
	) : (
		<div>
			<h1>Solicitud # {order._id}</h1>
			<div className={styles.container}>
				<TurnScreen order={order} />
			</div>
		</div>
	);
}
